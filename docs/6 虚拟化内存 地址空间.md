### 地址空间

虚拟化内存的本质是虚拟地址到物理地址的映射，每个应用的虚拟地址总和构成地址空间。

- 每个应用认为自己独占地址空间那么大的内存
- 地址空间从 0 开始，应用可以随便自己布局内存分布，不会影响别人
- 切换应用也要切换地址空间，包括应用和内核，所以 trap 的时候也要切换

```rust
pub struct MemorySet {
    page_table: PageTable,
    areas: Vec<MapArea>,
}
```

- 每个地址空间都有一个页表和若干逻辑段，页表是存储地址映射的数据结构，下节讲，单个页不好统一管理，逻辑段是一组功能相同的页的组合，用来统一管理页。

```rust
pub struct MapArea {
    vpn_range: VPNRange,
    data_frames: BTreeMap<VirtPageNum, FrameTracker>,
    map_type: MapType,
    map_perm: MapPermission,
}
```

### 虚拟地址相关的数据结构

- 虚拟地址
- 物理地址
- 虚拟页号
- 物理页号
- 物理帧